<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cytoscape.js - 数据导出</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <style>
      #cy {
        width: 600px;
        height: 400px;
        border: 1px solid #ccc;
        margin: 20px auto;
      }
      .controls {
        text-align: center;
        margin: 10px;
      }
      button {
        margin: 5px;
        padding: 5px 10px;
      }
      #output {
        margin: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <div class="controls">
      <button onclick="exportJSON()">导出 JSON</button>
      <button onclick="exportPNG()">导出 PNG</button>
      <button onclick="exportSVG()">导出 SVG</button>
      <button onclick="saveSnapshot()">保存快照</button>
      <button onclick="restoreSnapshot()">恢复快照</button>
    </div>
    <div id="cy"></div>
    <div id="output"></div>
    <script>
      let lastSnapshot = null;

      const cy = cytoscape({
        container: document.getElementById("cy"),
        elements: [
          // 节点
          { data: { id: "a", label: "节点 A" } },
          { data: { id: "b", label: "节点 B" } },
          { data: { id: "c", label: "节点 C" } },
          // 边
          {
            data: {
              id: "ab",
              source: "a",
              target: "b",
              label: "关系 AB",
            },
          },
          {
            data: {
              id: "bc",
              source: "b",
              target: "c",
              label: "关系 BC",
            },
          },
        ],
        style: [
          {
            selector: "node",
            style: {
              "background-color": "#666",
              label: "data(label)",
              width: 30,
              height: 30,
            },
          },
          {
            selector: "edge",
            style: {
              width: 2,
              "line-color": "#999",
              "curve-style": "bezier",
              "target-arrow-shape": "triangle",
              label: "data(label)",
            },
          },
        ],
        layout: {
          name: "grid",
        },
      });

      // 导出 JSON
      function exportJSON() {
        const jsonData = cy.json();
        const jsonString = JSON.stringify(jsonData, null, 2);

        // 显示 JSON 数据
        document.getElementById("output").innerHTML = `
          <pre>${jsonString}</pre>
        `;

        // 创建下载链接
        const blob = new Blob([jsonString], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "graph.json";
        link.click();
      }

      // 导出 PNG
      function exportPNG() {
        const png64 = cy.png({
          scale: 2,
          full: true,
          quality: 1,
        });

        // 创建下载链接
        const link = document.createElement("a");
        link.href = png64;
        link.download = "graph.png";
        link.click();
      }

      // 导出 SVG
      function exportSVG() {
        const svgContent = cy.svg({
          scale: 1,
          full: true,
          bg: "#ffffff",
        });

        // 创建下载链接
        const blob = new Blob([svgContent], {
          type: "image/svg+xml;charset=utf-8",
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "graph.svg";
        link.click();
      }

      // 保存快照
      function saveSnapshot() {
        lastSnapshot = {
          elements: cy.json().elements,
          layout: {
            name: cy.layout().options.name,
            options: cy.layout().options,
          },
          style: cy.style().json(),
          zoom: cy.zoom(),
          pan: cy.pan(),
        };

        document.getElementById("output").innerHTML = "状态已保存";
      }

      // 恢复快照
      function restoreSnapshot() {
        if (!lastSnapshot) {
          document.getElementById("output").innerHTML = "没有可用的快照";
          return;
        }

        cy.elements().remove();
        cy.add(lastSnapshot.elements);
        cy.style(lastSnapshot.style);
        cy.zoom(lastSnapshot.zoom);
        cy.pan(lastSnapshot.pan);
        cy.layout(lastSnapshot.layout).run();

        document.getElementById("output").innerHTML = "状态已恢复";
      }
    </script>
  </body>
</html>
